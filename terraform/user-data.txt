#!/bin/bash

sudo apt-get -y update

sudo apt-get install -y git unzip curl jq zsh

# Install AWS CLI
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
aws --version

# Install TF
# curl -O -L  https://releases.hashicorp.com/terraform/1.3.1/terraform_1.3.1_linux_amd64.zip
# unzip terraform_1.3.1_linux_amd64.zip
# sudo mv ./terraform /usr/bin/
# terraform --version

# Install Docker
# curl -fsSL https://get.docker.com -o get-docker.sh
# sh get-docker.sh

# Install k8s tools
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

curl -sLS https://get.k3sup.dev | sh
sudo install k3sup /usr/local/bin/

# Install code-server
curl -fsSL https://code-server.dev/install.sh | sh
sudo systemctl enable --now code-server@ubuntu
sed -i "s/127.0.0.1/0.0.0.0/"                       /home/ubuntu/.config/code-server/config.yaml
sed -i "s/^password.*/password: 76jwm0p0c3w1c/g"    /home/ubuntu/.config/code-server/config.yaml
sudo systemctl restart code-server@ubuntu

echo '#!/bin/sh

sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

' > /home/ubuntu/bootstrap.sh && chomd +x /home/ubuntu/bootstrap.sh && chown ubuntu:ubuntu /home/ubuntu/bootstrap.sh
